<style type="text/css">
    .back-to-top {
        cursor: pointer;
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: none;
    }

    th {
        text-align: center;
    }
</style>
<script src='@Url.Content("~/resources/js/jquery.validate.min.js")' type="text/javascript"></script>
<script src='@Url.Content("~/resources/js/jquery.validate.unobtrusive.min.js")' type="text/javascript"></script>

<script src='@Url.Content("~/resources/js/moment.min.js")'></script>
<script src='@Url.Content("~/resources/js/id.js")'></script>
<script src='@Url.Content("~/resources/js/bootstrap-datetimepicker.min.js")'></script>

<link href='@Url.Content("~/resources/css/dataTables.bootstrap.min.css")' rel="stylesheet" />
<script src='@Url.Content("~/resources/js/jquery.dataTables.min.js")'></script>
<script src='@Url.Content("~/resources/js/dataTables.bootstrap.min.js")'></script>

<div id="dynamic_content">
    <div class="page-title">
        <div class="title_left">
        </div>
    </div>
    <div class="clearfix"></div>
    <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="x_panel">
                <div class="x_title">
                    <h2>Daftar Program</h2>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    <form class="form-horizontal form-label-left" id="frmsearch" method="post">
                        @*<div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12">Status : </label>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <select name="cmbstatus" id="cmbstatus" class="select2_single form-control" data-placeholder="Pilih Status"></select>
                                </div>
                            </div>
                        </div>*@
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12">Nama Program : </label>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <input name="innamaprogram" id="innamaprogram" class="form-control" type="text" placeholder="Nama Program"/>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="form-group">
                    <div class="col-md-3 col-lg-offset-3 col-sm-3 col-xs-12">
                        <button id="btncari" type="button" class="btn btn-info"><span class="fa fa-search"></span> Cari </button>
                        <button id="btntambah" type="button" class="btn btn-success"><span class="fa fa-plus"></span> Tambah </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="tableholder">
    </div>

    <div class="x_panel">

        <form class="form-horizontal form-label-left pnbp-group-table" id="frmdatakodespan" method="post" data-name="kodespan">
            <div class="form-group" id="group_kodespan">
                <table id="tblprogram" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th style="width:5%;">No</th>
                            <th style="width:40%;">Nama Program</th>
                            <th style="width:10%;">Kode</th>
                            <th style="width:35%;">Tipe Manfaat</th>
                            <th style="width:5%;">Tipe</th>
                            <th style="width:5%;">Tahun</th>
                            @*<th>Kegiatan</th>*@
                            <th class="text-center" style="width:10%;">Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </form>

    </div>
</div>

<a id="back-to-top" href="#" class="btn btn-primary back-to-top" role="button" title="" data-toggle="tooltip" data-placement="left"><span class="glyphicon glyphicon-chevron-up"></span></a>

<script type="text/javascript">

    function checkAll(ele) {
        var checkboxes = document.getElementsByTagName('input');
        if (ele.checked) {
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i].type == 'checkbox') {
                    checkboxes[i].checked = true;
                    $('.check').val('2');
                }
            }
        } else {
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i].type == 'checkbox') {
                    checkboxes[i].checked = false;
                    $('.check').val('on');
                }
            }
        }
    }

	function tableCheckAll(ele, selector) {
		var checkboxes = $(selector+' tbody input[type="checkbox"]');
		if (ele.checked) {
			for (var i = 0; i < checkboxes.length; i++) {
				checkboxes[i].checked = true;
			}
		} else {
			for (var i = 0; i < checkboxes.length; i++) {
				checkboxes[i].checked = false;
			}
		}
    }

	function tableUncheckAll(selector) {
		var checkboxes = $(selector + ' tbody input[type="checkbox"]');
		for (var i = 0; i < checkboxes.length; i++) {
			checkboxes[i].checked = false;
		}
    }

    function displayTable(name) {
        $('.pnbp-group-table').toggleClass('hide', true);
        $('.pnbp-group-table[data-name="'+name+'"]').toggleClass('hide', false);
    }

    function getProgram(namaProgram)
    {
        $.blockUI({ message: '<div style=\"padding:10px\"><b>Sedang proses... </b><p>harap tunggu</p></div>' });
        $.ajax({
            type: 'POST',
            url: '@Url.Action("GetData", "Program")',
            data: { page: 1, offset: 100, namaProgram: namaProgram},
            success: function (data) {
                $.unblockUI();
                displayTableKodeSpan(data);
            }, error: function (request, status, error) {
                $.unblockUI();
            }
        });
    }

    function displayTableKodeSpan(result) {
        displayTable('kodespan');
        var data = result.data;
        var html = "";
		if (data.length > 0) {
			var i = 0;
			var label;
			$.each(data, function (x) {
				i = x + 1;

                //let kodeoutput = (data[x].KodeOutput !== undefined) ? data[x].KodeOutput : '';
                //let namaprogram = (data[x].NamaProgram !== undefined && data[x].NamaProgram !== null) ? data[x].NamaProgram : '';
                //let tipe = (data[x].Tipe !== undefined && data[x].Tipe !== null) ? data[x].Tipe : '';
                //let kode = (data[x].Kode !== undefined) ? data[x].Kode : '';
                //let kegiatan = (data[x].Kegiatan !== undefined) ? data[x].Kegiatan : '';

                let programId = (data[x].ProgramId !== undefined) ? data[x].ProgramId : '';
                let nama = (data[x].Nama !== undefined) ? data[x].Nama : '';
                let namaprogram = (data[x].NamaProgram !== undefined && data[x].NamaProgram !== null) ? data[x].NamaProgram : '';
                let namaKegiatan = (data[x].NamaKegiatan !== undefined && data[x].NamaKegiatan !== null) ? data[x].NamaKegiatan : '';
                let tipeManfaat = (data[x].TipeManfaat !== undefined && data[x].TipeManfaat !== null) ? data[x].TipeManfaat : '';
                let tipe = (data[x].TipeOps !== undefined && data[x].TipeOps !== null) ? data[x].TipeOps : '';

				html += ""
					+ "<tr>"
					+ "<td class='text-center'>" + i + "</td>"
                    + "<td class='text-left'>" + nama + "</td> <input type='hidden' name='kodeoutput[]' value='" + nama + "'/> </td>"
                    //+ "<td class='text-left'>" + namaprogram + "</td>"
                    + "<td class='text-right'>" + namaKegiatan + "</td>"
                    + "<td class='text-right'>" + tipeManfaat + "</td>"
                    + "<td class='text-left'>" + tipe + "</td>"
                    + "<td class='text-center'> <button type='button' class='btn btn-success' onclick='goToDetail(\"" + programId + "\")'><i class='fa fa-pencil'></i></button> </td>"
                    + "</tr>";
			});
			//$("#index").val(i);
		} else {
			html = "<tr><td colspan='6' class='text-center'>Data Tidak Tersedia</td></tr>";
		}
		$("#group_kodespan tbody").html(html);
    }

    function goToDetail(programid) {
        if (programid != undefined && programid != null && programid != "") {
            location.href = '@Url.Action("edit")?id=' + programid;
        } else {
            showmsg('Perhatian!', 'Data tidak ditemukan. Silakan hubungi Administrator');
        }
    }

    function getStatus()
    {
        var listStatus = [];
        listStatus.push({ id: 2, label: "Belum Lengkap" });
        listStatus.push({ id: 1, label: "Semua"});
        listStatus.push({ id: 3, label: "Lengkap"});

        var html = "";
        $.each(listStatus, function (x) {
            html += ("<option value='" + listStatus[x].id + "'>" + listStatus[x].label + "</option>")
        });
        $("#cmbstatus").html(html);

        getProgram('');
    }

    (function (a) { a.createModal = function (b) { defaults = { title: "", message: "Your Message Goes Here!", closeButton: true, scrollable: false }; var b = a.extend({}, defaults, b); var c = (b.scrollable === true) ? 'style="max-height: 420px;overflow-y: auto;"' : ""; html = '<div class="modal fade" id="myModal">'; html += '<div class="modal-dialog">'; html += '<div class="modal-content">'; html += '<div class="modal-header">'; html += '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>'; if (b.title.length > 0) { html += '<h4 class="modal-title">' + b.title + "</h4>" } html += "</div>"; html += '<div class="modal-body" ' + c + ">"; html += b.message; html += "</div>"; html += '<div class="modal-footer">'; if (b.closeButton === true) { html += '<button type="button" class="btn btn-primary" data-dismiss="modal" id="btn-ok">OK</button>' } html += "</div>"; html += "</div>"; html += "</div>"; html += "</div>"; a("body").prepend(html); a("#myModal").modal().on("hidden.bs.modal", function () { a(this).remove() }) } })(jQuery);

    function showmsg(judul, isi) {
        $.createModal({
            title: judul,
            message: isi,
            closeButton: true,
            scrollable: false
        });
        return false;
    };

    $(document).ready(function () {

        $(window).scroll(function () {
            if ($(this).scrollTop() > 50) {
                $('#back-to-top').fadeIn();
            } else {
                $('#back-to-top').fadeOut();
            }
        });
        // scroll body to 0px on click
        $('#back-to-top').click(function () {
            $('#back-to-top').tooltip('hide');
            $('body,html').animate({
                scrollTop: 0
            }, 800);
            return false;
        });

        $('#back-to-top').tooltip('show');

        $('#tblprogram').on('click', 'td', function () {
            console.log("oke");
        });

        //getStatus();
        createPagingPengajuan();

    });

    var dtablePengajuan;
    var page = 1;
    var offset = 35;
    var isSearch = false;
    var createPagingPengajuan = function () {
        dtablePengajuan = $('#tblprogram')
            .on('page.dt', function () {
                page = (dtablePengajuan.page.info().page + 1);
                console.log(dtablePengajuan.page.info().page);
                /*eventFired('Page');*/
            }).DataTable({
            "bLengthChange": false,
            "paging": true,
            "pageLength": offset,
            "bFilter": false,
            "ordering": false,
            "info": false,
            //"fnDrawCallback": function (oSettings) {
            //    page = (this.api().page.info().page + 1);
            //    console.log(this.api().page.info());
            //},
            "processing": true,
            "serverSide": true,
            "scrollX": false,
            "ajax": {
                url: '@Url.Action("GetData", "Program")',
                type: "POST",
                data: function (data, obj) {
                    var ftp = [];
                    data.form = ftp;                    
                    ftp.push({ name: "page", value: page }, { name: "offset", value: offset });
                    if (isSearch) {
                        var namaProgram = $('#innamaprogram').val();
                        ftp.push({ name: "namaProgram", value: namaProgram });
                    }
                    return ftp;
                }
                //,
                //dataSrc: function (json) {
                //    console.log('cetes');
                //    page++;
                //    return json.data;
                //}
            },

            "columns": [
                { "data": "RNumber", "className": "centertaligncolumn", "width": "5%" },
                { "data": 'Nama' },
                { "data": 'Kode' },
                { "data": "TipeManfaat" },
                { "data": "TipeOps" },
                { "data": "Tahun" },
                {
                    "data": "data",
                    "className": "centertaligncolumn",
                    "width": "5%",
                    render: function (datum, type, row) {
                        return "<button type='button' class='btn btn-success' onclick='goToDetail(\"" + row.ProgramId + "\")'><i class='fa fa-pencil'></i></button> </td>";
                    }
                },
            ],
        });
    };

    $("#frmsearch").submit(function (e) {
        if ($("#frmsearch").valid()) {
            var status = $("#cmbstatus").val();
            console.log(status);
            if (checkvar != "") {
                //console.log('valid');
                formToPost = $('#frmalok');
                console.log(formToPost);
            }
            else {
                showmsg('Perhatian!', '<h4 style="text-align:center;">Nilai input alokasi kosong.</h4>');
            }
        }
        e.preventDefault();
        return false;
    });

    $('#btncari').on('click', function () {
        //var status = $("#cmbstatus").val();
        //var namaProgram = $("#innamaprogram").val();
        //getProgram(namaProgram);
        isSearch = true;
        dtablePengajuan.ajax.reload();
    });

    $('#btntambah').on('click', function () {
        location.href = '@Url.Action("create")';
    });

    function show_error(message) {
        let defaultMessage = "Terjadi Kesalahan";
		swal({
			title: "",
			text: (typeof (message) != 'undefined') ? message : defaultMessage,
			type: "warning"
		});
    }

</script>


