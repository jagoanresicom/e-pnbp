@model Pnbp.Entities.FindManfaat
@{
	var lsTahun = new List<SelectListItem>();
	for (var i = DateTime.Now.Year; i >= (DateTime.Now.Year - 5); i--)
	{
		lsTahun.Add(new SelectListItem { Value = i.ToString(), Text = i.ToString() });
	}
}

<script src='@Url.Content("~/resources/js/infiniteScroll.js")'></script>
<style nonce="MjI3NzUzMQ">
	.panel-container {
		padding: 16px;
	}

	.dataTables_processing[style="display: block;"] {
		display: flex !important;
		justify-content: center;
		align-items: center;
		min-height: 37px;
	}

	.thead-row-no-border-bottom th {
		border-bottom: 0px !important;
	}
</style>


<div class="" id="dynamic_content">
	<div class="row">
		<div class="col-md-12 col-sm-12 col-xs-12">
			<div class="x_panel panel-container">
				<div class="x_title">
					<h2>Belanja KRO @ViewBag.nama_kantor</h2>
					<ul class="nav navbar-right panel_toolbox hide">
						<li>
							<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
						</li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
						</li>
						<li>
							<a class="close-link"><i class="fa fa-close"></i></a>
						</li>
					</ul>
					<div class="clearfix"></div>
				</div>
				<div class="x_content">


					<form class="form-horizontal form-label-left" id="js-frm-pencarian" role="form" method="post" enctype="multipart/form-data">
						@Html.AntiForgeryToken()
						@Html.HiddenFor(m => m.KantorId)

						<div class="row">
							<div class="form-group">
								<label class="control-label col-md-3 col-sm-3 col-xs-12">Tahun : </label>
								<div class="col-md-4 col-sm-4 col-xs-12">
									@Html.DropDownListFor(model => model.tahun, lsTahun, " -- Pilih Tahun --", new { @class = "select2_single form-control input-md" })
								</div>
							</div>
							<div class="form-group">
								<label class="control-label col-md-3 col-sm-3 col-xs-12">Kode KRO : </label>
								<div class="col-md-4 col-sm-4 col-xs-12">
									<input type="text" class="form-control" name="kodeKRO" />
								</div>
							</div>
						</div>

						<div class="row">
							<label class="control-label col-md-3 col-sm-3 col-xs-12"></label>
							<div class="col-md-6 col-sm-6 col-xs-12">
								<button id="btn-cari" type="submit" class="btn btn-success">Cari</button>
								<button class="MjI3NDA2Mw btn btn-info">Kembali</button>
							</div>
						</div>
						<br>

						<div class="table-responsive">
							<table id="eventsTable" class="table table-striped table-bordered" style="width:100%">
								<thead>
									<tr>
										<th>No</th>
										<th>Kode KRO</th>
										@*<th class="text-center">KRO</th>*@
										<th class="text-center">Pagu</th>
										@*<th class="text-center">Alokasi</th>*@
										<th class="text-center">Realisasi</th>
										@*<th>%Pagu</th>*@
										@*<th>%Alokasi</th>*@
									</tr>
								</thead>
							</table>
						</div>
					</form>

				</div>
			</div>
		</div>
	</div>

</div>


<div id='myModalDocViewer' class='modal'>
	<div class="modal-dialog">
		<div class="modal-content">
			<div id='myModalContent'></div>
		</div>
	</div>
</div>


<a id="back-to-top" href="#" class="btn btn-primary back-to-top" role="button" title="" data-toggle="tooltip" data-placement="left"><span class="glyphicon glyphicon-chevron-up"></span></a>

<script type="text/javascript" nonce="MjI3NzUzMQ">
    $(function () {
        $("div#loading").hide();
	});

	$(document).ready(function () {

		let frmPencarian = $('#js-frm-pencarian');
		frmPencarian.on('submit', (e) => {
			e.preventDefault();
			dTable.draw();
		})

        $('#myModalDocViewer').on('shown.bs.modal', function () {
            $(this).find('.modal-dialog').css({
                width: '98%',
                height: '98 %',
                'max-height': '98%'
            });
        });

        $(window).scroll(function () {
            if ($(this).scrollTop() > 50) {
                $('#back-to-top').fadeIn();
            } else {
                $('#back-to-top').fadeOut();
            }
        });
        // scroll body to 0px on click
        $('#back-to-top').click(function () {
            $('#back-to-top').tooltip('hide');
            $('body,html').animate({
                scrollTop: 0
            }, 800);
            return false;
        });

		$('#back-to-top').tooltip('show');

		let dTable = $('#eventsTable').DataTable({
			"bLengthChange": false,
			"paging": true,
			"pageLength": 10,
			"bFilter": false,
			"ordering": false,
			"info": false,
			"processing": true,
			"serverSide": true,
			"scrollX": false,
            "ajax": {
			    url: '@Url.Action("rl_kro_list", "Pemanfaatan")',
                type: "POST",
			    data: function (data, obj) {
                    var ftp = frmPencarian.serializeArray();
                    data.form = ftp;
					ftp.push({ name: "start", value: data.start });
                    return ftp;
			    }
			},
			"headerCallback": function (thead, data, start, end, display) {
				let totalalokasi = 0;
				let totalpagu = 0;
				if (data.length > 0) {
					totalalokasi = formatAngka(data[0].totalalokasi);
					totalpagu = formatAngka(data[0].totalpagu);
				}
				//$(thead).parent().prepend(`<tr class="thead-row-no-border-bottom"><th colspan="3" class="numeric">Total</th><th class="text-right">${totalpagu}</th><th class="disabled"></th></tr>`)
				$(thead).parent().prepend(`<tr class="thead-row-no-border-bottom"><th colspan="2" class="numeric">Total Alokasi</th><th class="text-right">${totalalokasi}</th><th class="disabled"></th></tr>`)
				if ($(thead).hasClass('thead-row-no-border-bottom')) {
					//$('.thead-row-no-border-bottom').last().remove()
					$('.thead-row-no-border-bottom').last().remove()
				}
			},
			"columns": [
				{ "data": "RNumber", "className": "centertaligncolumn", "width": "5%" },
				{ "data": "KodeKRO", "className": "centertaligncolumn", "width": "5%" },
				//{ "data": "KRO", "className": "", "width": "5%", "render": formatAngka },
				{ "data": "Pagu", "className": "text-right", "width": "5%", "render": formatAngka },
				//{ "data": "Alokasi", "className": "text-right", "width": "5%", "render": formatAngka },
				{ "data": "Realisasi", "className": "text-right", "width": "5%", "render": formatAngka },
				//{ "data": "PersentaseAlokasi", "className": "centertaligncolumn", "width": "5%" },
				//{ "data": "PersentasePagu", "className": "centertaligncolumn", "width": "5%" },
			],
		});

		function formatAngka(data) {
			if (data === undefined) {
				return '';
			}
			let formattedString = formatangka(data);
			if (formattedString == 'null') {
				return '';
			}
			return formattedString;
		}

        $('.MjI3NDA2Mw').on('click', (ev) => {
            history.back()
		});

        let getQueryParameter = (param) => new URLSearchParams(document.location.search.substring(1)).get(param);
        if (getQueryParameter('pid')) {
            frmPencarian.submit();
        }

    });

</script>

