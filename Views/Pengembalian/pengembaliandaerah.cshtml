@model Pnbp.Entities.DataPengembalianPnbpDev
@{
    ViewBag.Title = "PengajuanPengembalianDetail";
    var Pengembaliandata = ViewBag.Pengembaliandata;
    var file1 = ViewBag.file1;
    var file2 = ViewBag.file2;
    var file3 = ViewBag.file3;
    var file4 = ViewBag.file4;
    var file5 = ViewBag.file5;
    var file6 = ViewBag.file6;
    var file7 = ViewBag.file7;
    var file8 = ViewBag.file8;
    var file9 = ViewBag.file9;
    var file10 = ViewBag.file10;
    var file11 = ViewBag.file11;
}

<style>
	/*panel style overwrite*/
	.panel-heading {
		background: white !important;
		padding: 10px 0!important;
        font-size: 1.6rem!important;
	}
	.panel-default {
	    padding: 0 12px!important;
    }
	.panel-body {
		margin-top: 10px;
	}

	.template-section > div {
		margin-bottom: 1.35rem;
	}
</style>

<form class="form-horizontal" method="post" enctype="multipart/form-data" id="pengembalian_form">
    <div class="" id="dynamic_content">
        <input type="hidden" name="pengembalianpnbpid" id="pengembalianpnbpid" value="@Pengembaliandata.PENGEMBALIANPNBPID" />
        <div class="clearfix"></div>

        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div style="padding-top:10px;">
                    @*<div class="x_title">
                            <h2>Pencarian Data</h2>
                            <div class="clearfix"></div>
                        </div>*@

                    <input type="hidden" name="Status" id="Stataus" />
                    <div class="text-right" style="margin-bottom:8px;">
                        @*<a href="@Url.Action("PengajuanPengembalianIndex","Pengembalian")" class="btn btn-default"><i class="fa fa-reply"></i> Kembali</a>*@
                        <a href="@Url.Action("mon_pengembalian","Pengembalian")" class="btn btn-default"><i class="fa fa-reply"></i> Kembali</a>
                    </div>
                    <div class="row">
                        <div class="col-md-4">

                            <div class="panel panel-default x_panel">
                                <div class="panel-heading x_title">
                                    Data Berkas
									<ul class="nav navbar-right panel_toolbox">
										<li>
											<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
										</li>
										<li class="dropdown">
											<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
										</li>
										<li>
											<a class="close-link"><i class="fa fa-close"></i></a>
										</li>
									</ul>
                                </div>
                                <div class="panel-body form-horizontal x_content">
                                    @* form *@
                                    <div class="form-group">
                                        <input type="hidden" name="satker" id="satker" value="@(new Pnbp.Codes.Functions().claimUser().NamaKantor.Replace("Kantor Pertanahan", ""))" />
                                        <label for="inputEmail3" class="col-sm-4 control-label" style="text-align:left;">Nomor Berkas</label>
                                        <div class="col-sm-8">
                                            <input type="text" name="NomorBerkas" id="nmorberkas" class="form-control" value="@Pengembaliandata.NOMORBERKAS" placeholder="Input Nomor Berkas" readonly/>
                                            @*@Html.TextBoxFor(model => model.NomorBerkas, new { @class = "form-control", @id = "nomorberkas", @required = "required", @placeholder = "Nomor/Tahun",@value= @Pengembaliandata.NOMORBERKAS })*@
                                        </div>
                                        @*<div class="col-sm-2 text-left"><button type="button" class="btn btn-primary" onclick="cari_berkas()" style="margin-left:0px;"><span class="fa fa-search"></span></button></button></div>*@
                                    </div>
                                    <div class="form-group">
                                        <label for="inputPassword3" class="col-sm-4 control-label" style="text-align:left;">Atas Nama</label>
                                        <div class="col-sm-8">
                                            @*@Html.TextBoxFor(model => model.NamaPemohon, new { @class = "form-control", @id = "namapemohon", @placeholder = "Nama Pemohon", @readonly = "readonly", @style = "color:#000000; border-color:#ffffff; box-shadow: none !important;  font-family: 'Varela Round', sans-serif; font-size: small;" })*@
                                            @*@Html.TextBoxFor(model => model.NamaPemohon, new { @class = "form-control", @id = "namapemohon", @placeholder = "Nama Pemohon", @readonly = "readonly" })*@
                                            <input type="text" name="NamaPemohon" id="namapemohon" class="form-control" value="@Pengembaliandata.NAMAPEGAWAIPENGAJU" readonly />
                                        </div>
                                    </div>
                                    <input type="hidden" id="NamaProsedur" name="NamaProsedur" />
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-4 control-label" style="text-align:left;">Alamat</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="Alamat" name="Alamat" placeholder="Alamat">*@
                                            @*@Html.TextBoxFor(model => model.AlamatPemohon, new { @class = "form-control", @id = "AlamatPemohon", @placeholder = "Alamat Pemohon", @readonly = "readonly" })*@
                                            <input type="text" name="AlamatPemohon" id="AlamatPemohon" class="form-control" value="@Pengembaliandata.ALAMATPEMOHON" readonly />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputPassword3" class="col-sm-4 control-label" style="text-align:left;">NPWP</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="NPWP" name="NPWP" placeholder="NPWP">*@
                                            @* @Html.TextBoxFor(model => model.Npwp, new { @class = "form-control", @id = "Npwp", @placeholder = "NPWP", @readonly = "readonly" })*@
                                            <input type="text" name="Npwp" id="Npwp" class="form-control npwp" data-mask="00.000.000.0-000.000" value="@Pengembaliandata.NPWPPEGAWAIPENGAJU" readonly />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-4 control-label" style="text-align:left;">Kode Biling</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="KodeBiling" name="KodeBiling" placeholder="Kode Biling">*@
                                            @*@Html.TextBoxFor(model => model.KodeBilling, new { @class = "form-control", @id = "KodeBiling", @placeholder = "Kode Biling", @readonly = "readonly" })*@
                                            <input type="text" name="Kodebilling" id="KodeBiling" class="form-control" value="@Pengembaliandata.KODEBILLING" readonly />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputPassword3" class="col-sm-4 control-label" style="text-align:left;">NTPN</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="NTPN" name="NTPN" placeholder="NTPN">*@
                                            @*@Html.TextBoxFor(model => model.Ntpn, new { @class = "form-control", @id = "Ntpn", @placeholder = "NTPN", @readonly = "readonly" })*@
                                            <input type="text" name="Ntpn" id="Ntpn" class="form-control" value="@Pengembaliandata.NTPN" readonly />
                                        </div>
                                    </div>
                                    @*@if (Pengembaliandata.STATUSPENGEMBALIAN == 0 || Pengembaliandata.STATUSPENGEMBALIAN == 3)
                                    {*@
                                        <div class="form-group">
                                            <div class="col-sm-12">
                                                @*<button type="submit" id="simpan" form="pengembalian_form" class="btn btn-primary">Simpan</button>*@
                                                @*<button type="reset" class="btn btn-primary">Hapus</button>*@
                                            </div>
                                        </div>
                                   @*}*@
                                  
                                </div>
                            </div>

                        </div>
                        <div class="col-md-4">

                            <div class="panel panel-default x_panel">
								<div class="panel-heading x_title">
									Data Pengembalian
									<ul class="nav navbar-right panel_toolbox">
										<li>
											<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
										</li>
										<li class="dropdown">
											<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
										</li>
										<li>
											<a class="close-link"><i class="fa fa-close"></i></a>
										</li>
									</ul>
								</div>
                                <div class="panel-body form-horizontal x_content">
                                    @*Panel content*@
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-4 control-label" style="text-align:left;">Setoran PNBP</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="SetoranPnbp" placeholder="Setoran PNBP">*@
                                            @*@Html.TextBoxFor(model => model.SetoranPnbp, new { @class = "form-control", @id = "SetoranPnbp", @placeholder = "Setoran PNBP" ,@value="@Pengembaliandata.SETORANPNBP" })*@
                                            <input type="text" name="SetoranPnbp" id="SetoranPnbp" class="form-control asd text-right" value="@Convert.ToInt32(Pengembaliandata.SETORANPNBP).ToString("N0", new System.Globalization.CultureInfo("id-ID"))" onkeyup="addCommas(this)" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputPassword3" class="col-sm-4 control-label" style="text-align:left;">Jumlah Biaya yang sudah dikeluarkan</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="BiayaLayanan" name="BiayaLayanan" placeholder="Biaya Layanan" onkeypress="return hanyaAngka(event)">*@
                                            @*@Html.TextBoxFor(model => model.JumlahBayar, new { @class = "form-control", @id = "JumlahBayar", @placeholder = "jumlah Biaya Layanan Yang Sudah Dikeluarkan" })*@
                                            <input type="text" name="JumlahBayar" id="JumlahBayar" class="form-control asd text-right" value="@Convert.ToInt32(Pengembaliandata.JUMLAHBAYAR).ToString("N0", new System.Globalization.CultureInfo("id-ID"))" onkeyup="addCommas(this)" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-4 control-label" style="text-align:left;">Permohonan Pengembalian</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="PermohonanPengembalian" name="PermohonanPengembalian" placeholder="Permohonan Pengembalian">*@
                                            @*@Html.TextBoxFor(model => model.PermohonanPengembalian, new { @class = "form-control", @id = "PermohonanPengembalian", @placeholder = "Permohonan Pengembalian" })*@
                                            <input type="text" name="PermohonanPengembalian" id="PermohonanPengembalian" class="form-control asd text-right" value="@Convert.ToInt32(Pengembaliandata.PERMOHONANPENGEMBALIAN).ToString("N0", new System.Globalization.CultureInfo("id-ID"))" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="npwpberkas" class="col-sm-4 control-label" style="text-align:left;">NPWP</label>
                                        <div class="col-sm-8">
                                            <input type="text" name="npwpberkas" id="npwpberkas" class="form-control npwp" placeholder="NPWP" data-mask="00.000.000.0-000.000" value="@Pengembaliandata.NPWP" required />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputPassword3" class="col-sm-4 control-label" style="text-align:left;">Nama Rekening</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="NamaRekening" name="NamaRekening" placeholder="Nama Rekening">*@
                                            @*@Html.TextBoxFor(model => model.NamaRekening, new { @class = "form-control", @id = "NamaRekening", @placeholder = "Nama Rekening" })*@
                                            <input type="text" name="NamaRekening" id="NamaRekening" class="form-control" value="@Pengembaliandata.NAMAREKENING" required />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-4 control-label" style="text-align:left;">Nomor Rekening</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="NomorRekening" name="NomorRekening" placeholder="Nomor Rekening">*@
                                            @*@Html.TextBoxFor(model => model.NomorRekening, new { @class = "form-control", @id = "NomorRekening", @placeholder = "Nomor Rekening" })*@
                                            <input type="text" name="NomorRekening" id="NomorRekening" class="form-control" value="@Pengembaliandata.NOMORREKENING" required />
                                        </div>
                                    </div>
                                    @*<div class="form-group">
                                            <label for="inputPassword3" class="col-sm-4 control-label">NPWP</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="NPWP" name="NPWP" placeholder="NPWP">
                                            </div>
                                        </div>*@
                                    <div class="form-group">
                                        <label for="inputPassword3" class="col-sm-4 control-label" style="text-align:left;">Nama Bank</label>
                                        <div class="col-sm-8">
                                            @*<input type="text" class="form-control" id="NamaBank" name="NamaBank" placeholder="Nama Bank">*@
                                            @*@Html.TextBoxFor(model => model.NamaBank, new { @class = "form-control", @id = "NamaBank", @placeholder = "Nama Bank" })*@
                                            <input type="text" name="NamaBank" id="NamaBank" class="form-control" value="@Pengembaliandata.NAMABANK" required />
                                        </div>
                                    </div>

                                    <div class="ln_solid"></div>

                                    <button class="btn btn-primary">Proses</button>

                                </div>
                            </div>

                        </div>
                        <div class="col-md-4">

                            <div class="panel panel-default x_panel">
                                <div class="panel-heading x_title">
                                    Template Surat
									<ul class="nav navbar-right panel_toolbox">
										<li>
											<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
										</li>
										<li class="dropdown">
											<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
										</li>
										<li>
											<a class="close-link"><i class="fa fa-close"></i></a>
										</li>
									</ul>
                                </div>
                                @*<div class="panel-heading">Template Surat<br><small class="text-danger"><span class="text-danger">*</span>File yang dapat diupload berekstensi.pdf maksimal 5MB</small></div>*@
                                <div class="panel-body x_content">
                                    <div class="form-group">

										<div class="template-section">
											<div>
												<button type="button" class="btn btn-primary">Surat Permohonan Pengembalian</button>
											</div>
											<div>
												<button type="button" class="btn btn-primary">Surat Pernyataan PNBP Berutang</button>
											</div>
											<div>
												<button type="button" class="btn btn-primary">Surat Keterangan Pengeluaran</button>
											</div>
											<div>
												<button type="button" class="btn btn-primary">Surat Pernyataan Tidak Terlayani</button>
											</div>
											<div>
												<button type="button" class="btn btn-primary">Surat Kuasa Wajib Bayar</button>
											</div>
											<div>
												<button type="button" class="btn btn-primary">Surat Persetujuan</button>
											</div>
											<div>
												<button type="button" class="btn btn-primary">Surat Pernyataan Tanggung Jawab Mutlak</button>
											</div>
										</div>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</form>
<script type="text/javascript" src='@Url.Content("~/resources/js/jquery.mask.min.js")'></script>
<script>
    $(document).ready(function() {
        var statuspengembalian = @Pengembaliandata.STATUSPENGEMBALIAN;
        //alert(statuspengembalian);
        if (statuspengembalian == 0 || statuspengembalian == 3)
         {
             $("#pengembalian_form :input").prop("disabled", false);
        }else{
            $("#pengembalian_form :input").prop("disabled", true);
        }
    });
    $('.asd').keyup(function(event) {

        // skip for arrow keys
        if(event.which >= 37 && event.which <= 40) return;

        // format number
        $(this).val(function(index, value) {
            return value
            .replace(/\D/g, "")
            .replace(/\B(?=(\d{3})+(?!\d))/g, ".")
            ;
        });
    });

    // Validasi File > 5MB
    $('body').on('change','input:file', function() {
        let status = true
        //alert($(this)[0].files[0].type);
        if (['application/pdf'].includes(this.accept)) {
            if( !["application/pdf",".zip",".rar",".7zip"].includes($(this)[0].files[0].type)){
                alert('Format FIle Tidak Sesuai')
                status = false
            }
        }

        if ($(this).hasClass("max_5mb")) {
            if($(this)[0].files[0].size > 5000000){
                //alert('Ukuran File Lebih Dari 5MB')
                swal({
                    type: "error",
                    html: true,
                    title: "Gagal<br><small>Ukuran File Lebih Dari 5MB</small>",
                    confirmButtonColor: "#4CAF50"
                });
                status = false
            }
        }

        if (status) {
            // alert('aaaaaaaaaa');
            $('#cancel-'+this.id).html('<a href="javascript:void(0)" class="text-danger" onclick="cancelDoc(\''+this.id+'\')" title="Cancel File"><i class="icon-trash-2"></i> Cancel File</a>')
        } else {
            $(this).val('')
            $('#cancel-'+(this.id)).html('')
            $('#label-'+(this.id)).html('Test')
        }
    })

    const cancelDoc = (x) => {
        $('#'+x).val('')
        // alert(x)
        $('#cancel-'+x).html('')
        $('#label-'+x).html('Test')
    }
    // Validasi File > 5MB

    function hanyaAngka(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode
        if (charCode > 31 && (charCode < 48 || charCode > 57))

            return false;
        return true;
    }

     $('#simpan').click(function (e) {
        $('#Stataus').val('0');
        //setTimeout(function () {
        //    swal({
        //        type: "success",
        //        html: true,
        //        title: "Data Berhasil Disimpan",
        //        confirmButtonColor: "#4CAF50"
        //    });
        //}, 3000);
    });

    $('#proses').click(function (e) {
        $('#Stataus').val('1');
        //setTimeout(function () {
        //    swal({
        //        type: "success",
        //        html: true,
        //        title: "Data Berhasil Disimpan",
        //        confirmButtonColor: "#4CAF50"
        //    });
        //}, 3000);
    });

    function cari_berkas() {
        //alert($('#nomorberkas').val());
        $.ajax({
            url: '@Url.Action("GetBerkasDataByID", "Pengembalian")',
            type: 'post',
            data: {noberkas:$('#nomorberkas').val()},
            success: function (res) {
                //if (res.length > 0) {
                    console.log(res);
                    $('#namapemohon').val(res.NAMA);
                    $('#AlamatPemohon').val(res.ALAMAT);
                    $('#Nppwp').val(res.NPWP);
                    $('#KodeBiling').val(res.KODEBILLING);
                    $('#Ntpn').val(res.NTPN);
                    $('#NamaProsedur').val(res.NAMAPROSEDUR);
                    $('#SetoranPnbp').val(res.PENERIMAAN);
                ////} ELSE {
                ////    ALERT("DATA TIDAK DITEMUKAN..");
                    //ALERT(RES.length);
                ////}
            }
        });
    }

    function addCommas(nStr) {
        nStr += '';
        x = nStr.split(',');
        x1 = x[0];
        x2 = x.length > 1 ? ',' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + '.' + '$2');
        }
        return x1 + x2;
    }

    $('#SetoranPnbp').keyup(function(event){
        return addCommas($(this).val());
    });


    $('#pengembalian_form').submit(function () {
        //setTimeout(function () {
        //    swal({
        //        type: "success",
        //        html: true,
        //        title: "Data Berhasil Disimpan",
        //        confirmButtonColor: "#4CAF50"
        //    });
        //}, 3000);
    });

    $('#SetoranPnbp').keyup(function (event) {
        var JumlahBayar = parseInt(($('#JumlahBayar').val() != '') ? $('#JumlahBayar').val().replace(/\./g, ""): 0);
        var SetoranPnbp = parseInt(($('#SetoranPnbp').val() != '') ? $('#SetoranPnbp').val().replace(/\./g, ""): 0);

        if (Number(SetoranPnbp) < Number(JumlahBayar)) {
            var jml = '';
            $('#PermohonanPengembalian').val( jml);
        } else {
            var permohonanpengembalian = (Number(SetoranPnbp) - Number(JumlahBayar));
            var jml = permohonanpengembalian;
            $('#PermohonanPengembalian').val(addCommas(jml));
        }
        console.log(JumlahBayar);

    });

    $('#JumlahBayar').keyup(function (event) {
        var JumlahBayar = parseInt(($('#JumlahBayar').val() != '') ? $('#JumlahBayar').val().replace(/\./g, ""): 0);
        var SetoranPnbp = parseInt(($('#SetoranPnbp').val() != '') ? $('#SetoranPnbp').val().replace(/\./g, ""): 0);

        if (Number(SetoranPnbp) < Number(JumlahBayar)) {
            var jml = '';
            $('#PermohonanPengembalian').val(jml);
        } else {
            var permohonanpengembalian = (Number(SetoranPnbp) - Number(JumlahBayar));
            var jml = permohonanpengembalian;
            $('#PermohonanPengembalian').val(addCommas(jml));
        }
        console.log(parseInt(JumlahBayar));

    });

    function generate_permohonan() {
        var url = '@Url.Action("GeneratePermohonanPengembalian","Pengembalian")';
        var namapemohon = $('#namapemohon').val();
        var NomorSurat = $('#NomorSurat').val();
        var PermohonanPengembalian = $('#PermohonanPengembalian').val();
        var AlamatPemohon = $('#AlamatPemohon').val();
        var npwpberkas = $('#npwpberkas').val();
        var NamaRekening = $('#NamaRekening').val();
        var NomorRekening = $('#NomorRekening').val();
        var TanggalPengaju = $('#tanggalpengaju').val();
        window.open(url + '?namapemohon=' + namapemohon + '&NomorSurat=' + NomorSurat + '&PermohonanPengembalian=' + PermohonanPengembalian + '&AlamatPemohon=' + AlamatPemohon + '&npwpberkas=' + npwpberkas + '&NamaRekening=' + NamaRekening + '&NomorRekening=' + NomorRekening + '&tanggalpengaju='+ TanggalPengaju,'_blank');
    }

    function generate_keterangan() {
        var url = '@Url.Action("GenerateSuratKeteranganPengembalian","Pengembalian")';
        var nomorsurat = $('#NomorSurat').val();
        var nomorberkas = $('#nomorberkas').val();
        var namapemohon = $('#namapemohon').val();
        var SetoranPnbp = $('#SetoranPnbp').val();
        var JumlahBayar = $('#JumlahBayar').val();
        var NamaProsedur = $('#NamaProsedur').val();
        window.open(url + '?NomorSurat=' + nomorsurat + '&nomorberkas=' + nomorberkas + '&namapemohon=' + namapemohon + '&SetoranPnbp=' + SetoranPnbp + '&JumlahBayar=' + JumlahBayar + '&NamaProsedur=' + NamaProsedur, '_blank');
    }

    function generate_tidak_terlayani() {
        var url         = '@Url.Action("GenerateSuratTidakTerlayani", "Pengembalian")';
        var namapemohon = $('#namapemohon').val();
        var AlamatPemohon = $('#AlamatPemohon').val();
        var nomorberkas = $('#nomorberkas').val();
        var NamaProsedur = $('#NamaProsedur').val();
        window.open(url + '?namapemohon=' + namapemohon + '&AlamatPemohon=' + AlamatPemohon + '&nomorberkas=' + nomorberkas + '&NamaProsedur=' + NamaProsedur + '&satker=' + satker, '_blank');
    }
</script>