@model Pnbp.Entities.FindPengembalianPnbp

<script src='@Url.Content("~/resources/js/infiniteScroll.js")'></script>
<style>
	.panel-container {
		padding: 16px;
	}

	.dataTables_processing[style="display: block;"] {
		display: flex !important;
		justify-content: center;
		align-items: center;
		min-height: 37px;
	}

	.d-flex {
		display: flex;
	}
	.justify-content-center {
		justify-content: center;
	}
</style>


<div class="" id="dynamic_content">

	<div class="row">
		<div class="col-md-12 col-sm-12 col-xs-12">
			<div class="x_panel panel-container">
				<div class="x_title">
					<h2>Pengembalian PNBP</h2>
					<ul class="nav navbar-right panel_toolbox hide">
						<li>
							<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
						</li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
						</li>
						<li>
							<a class="close-link"><i class="fa fa-close"></i></a>
						</li>
					</ul>
					<div class="clearfix"></div>
				</div>
				<div class="x_content">
					<form class="form-horizontal form-label-left" id="frmCariManfaat" role="form" method="post" enctype="multipart/form-data">
						<div class="table-responsive">
							<table id="eventsTable" class="table table-striped table-bordered" style="width:100%">
								<thead>
									<tr>
										<th>No</th>
										<th>Satuan Kerja</th>
										<th>Nomor Berkas</th>
										<th>Nama Pemohon</th>
										<th>Nominal</th>
										<th>Nomor Surat</th>
										<th>Tangal Pengajuan</th>
										<th>SP2D</th>
										<th>Status</th>
										<th>Aksi</th>
									</tr>
								</thead>
								<tbody id="dataplaceholder"></tbody>
							</table>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

</div>


<div id='myModalDocViewer' class='modal'>
	<div class="modal-dialog">
		<div class="modal-content">
			<div id='myModalContent'></div>
		</div>
	</div>
</div>


<a id="back-to-top" href="#" class="btn btn-primary back-to-top" role="button" title="" data-toggle="tooltip" data-placement="left"><span class="glyphicon glyphicon-chevron-up"></span></a>

<script type="text/javascript">
    $(function () {
        $("div#loading").hide();
    });

    $(document).ready(function () {

		createPagingPengajuan();

        $('#myModalDocViewer').on('shown.bs.modal', function () {
            $(this).find('.modal-dialog').css({
                width: '98%',
                height: '98 %',
                'max-height': '98%'
            });
        });

        $(window).scroll(function () {
            if ($(this).scrollTop() > 50) {
                $('#back-to-top').fadeIn();
            } else {
                $('#back-to-top').fadeOut();
            }
        });
        // scroll body to 0px on click
        $('#back-to-top').click(function () {
            $('#back-to-top').tooltip('hide');
            $('body,html').animate({
                scrollTop: 0
            }, 800);
            return false;
        });

        $('#back-to-top').tooltip('show');
    });


	var dtablePengajuan;
	var createPagingPengajuan = function () {

		dtablePengajuan = $('#eventsTable').DataTable({
            "bLengthChange": false,
            "paging": true,
            "pageLength": 10,
            "bFilter": false,
            "ordering": false,
            "info": false,
            "processing": true,
            "serverSide": true,
            "scrollX": false,
            "ajax": {
				url: '@Url.Action("mon_pengembalian_list", "Pengembalian")',
                type: "POST",
				data: function (data, obj) { var ftp = $('#frmCariManfaat').serializeArray(); data.form = ftp; ftp.push({ name: "start", value: data.start }, { name: "length", value: data.length }); return ftp; }
            },
            "columns": [
                { "data": "RNumber", "className": "centertaligncolumn", "width": "5%" },
				{ "data": "NamaSatker", "className": "centertaligncolumn", "width": "20%"},
				{ "data": "NomorBerkas", "className": "centertaligncolumn", "width": "5%" },
				{ "data": "NamaPemohon", "className": "centertaligncolumn", "width": "20%" },
				{ "data": "permohonanpengembalian", "className": "rightaligncolumn", render: formatAngka },
				{ "data": "NomorSurat", "className": "centertaligncolumn", "width": "5%" },
				{ "data": "TanggalPengaju", "className": "centertaligncolumn", "width": "5%" },
				{ "data": null, "className": "centertaligncolumn", "width": "5%", "render": function () { return "" } },
				{
					"data": "StatusPengembalian",
					"className": "centertaligncolumn",
					"width": "10%",
					render: function (data) {
						if (data == null) {
							return '<span>Belum Kirim</span>'
						}
						if (data == '0') {
							return '<span>Belum Kirim</span>'
						}
						if (data == '1') {
							if (kantorid == '980FECFC746D8C80E0400B0A9214067D') {
								return '<span>Usulan Baru</span>'
							} else {
								return '<span>Terkirim</span>'
							}
						}
						if (data == '2') {
							return '<span>Proses</span>'
						}
						if (data == '3') {
							return '<span>Berkas Tidak Lengkap</span>'
						}
						if (data == '4') {
							return '<span>Selesai</span>'
						}
					}
				},
				{
					"data": null,
					"className": "centertaligncolumn",
					"width": "5%",
					"render": function (data, type, row) {
						var html = '<div class="text-center d-flex justify-content-center" style="gap:6px">';
						html += '<button type="button" class="btn btn-success js-btn-selesai">Selesai</button>';
						html += '<button type="button" class="btn btn-primary js-btn-edit"><i class="fa fa-pencil js-btn-edit"></i> Edit</button>';
						html += '</div>';
						return html;
					}
				},
            ],
		});

		$('#eventsTable tbody').delegate('tr td', 'click', function (e) {
			try {
				var data = dtablePengajuan.row($(this).closest('tr')).data();
				if (e.target.classList.contains('js-btn-selesai')) {
					selesai(e);
				} else if (e.target.classList.contains('js-btn-edit')) {
					redirectEdit(e, data);
				}
			} catch (e) {
				$.unblockUI();
			}
		});

		function selesai(e) {
			showmsg('Informasi', 'Fitur belum tersedia');
		}

		function redirectEdit(e, data) {
			//$.blockUI({ message: '<div style=\"padding:10px\"><b>Sedang proses... </b><p>harap tunggu</p></div>' });
			if($('#jeniskantor').val()=='Pusat'){
				window.location.href = '@Url.Action("PengajuanPengembalianDetailPusat", "Pengembalian")?pengembalianpnbpid=' + data.PengembalianPnbpId;

				e.preventDefault();
				return false;
			}else{
				window.location.href = '@Url.Action("PengajuanPengembalianDetail", "Pengembalian")?pengembalianpnbpid=' + data.PengembalianPnbpId;

				e.preventDefault();
				return false;
			}
		}

		//$('#myTablePengembalianPnbp tbody').delegate('tr u', 'click', function (e) {

			function formatAngka(data) {
				let formattedString = formatangka(data);
				console.log(formattedString)
				if (formattedString == 'null') {
					formattedString = '';
				}
				return formattedString;
			}

    };

</script>

