@model  Pnbp.Entities.CharDashboard
@{
    var penerimaan = ViewBag.total_penerimaan;
    var belanja = ViewBag.total_belanja;
    var persentase_penerimaan = ViewBag.persentase_penerimaan;
    var persentase_belanja = ViewBag.persentase_belanja;
}
<style>
    .control-label {
        padding-top: 8px;
        padding-right: 0px;
    }
</style>

<script src='@Url.Content("~/resources/js/echarts.min.js")'></script>
<script src='@Url.Content("~/resources/js/highcharts/highcharts.js")'></script>
<script src='@Url.Content("~/resources/js/highcharts/highcharts-more.js")'</script>
<script src='@Url.Content("~/resources/js/highcharts/highcharts-3d.js")'></script>
<script src='@Url.Content("~/resources/js/highcharts/modules/data.js")'></script>
<script src='@Url.Content("~/resources/js/highcharts/modules/drilldown.js")'></script>
<script src='@Url.Content("~/resources/js/highcharts/modules/exporting.js")'></script>
<script src='@Url.Content("~/resources/js/highcharts/modules/offline-exporting.js")'></script>

<div class="row" id="dynamicchart">
    @*@{Html.RenderAction("IndexPartial", "Home");}*@
    <div class="row">
        <div class="col-sm-12">
            @* Card Total Penerimaan *@
            <div class="col-md-3">
                <div class="tile-stats" style="height:135px">
                    @*<div class="icon"><i class="fa fa-caret-square-o-right"></i></div>*@
                    <h4 style="margin-top:20px"><center>Total<br>Penerimaan</center></h4>
                    <div style="margin:12px"><h2 style="font-size:15px; color:#02A35D" "><b><center>@penerimaan.jumlah.ToString("N0", new System.Globalization.CultureInfo("id-ID")) </center></b></h2></div>
                    <p></p>
                </div>
            </div>

            @* Card Total Belanja *@
            <div class="col-md-3">
                <div class="tile-stats" style="height:135px">
                    @*<div class="icon"><i class="fa fa-caret-square-o-right"></i></div>*@
                    <h4 style="margin-top:20px"><center>Total<br>Belanja</center></h4>
                    <div style="margin:12px"><h2 style="font-size:15px; color:#02A35D" "><b><center>@belanja.jumlah.ToString("N0", new System.Globalization.CultureInfo("id-ID")) </center></b></h2></div>
                    <p></p>
                </div>
            </div>

            @* Card Persentase Penerimaan *@
            <div class="col-md-3">
                <div class="tile-stats" style="height:135px">
                    @*<div class="icon"><i class="fa fa-caret-square-o-right"></i></div>*@
                    <h4 style="margin-top:20px"><center>Persentase <br> Penerimaan (%)</center></h4>
                    <div style="margin:12px"><h2 style="font-size:15px; color:#02A35D" "><b><center>@persentase_penerimaan.persentase.ToString("N0", new System.Globalization.CultureInfo("id-ID")) </center></b></h2></div>
                    <p></p>
                </div>
            </div>

            @* Card Persentase Belanja *@
            <div class="col-md-3">
                <div class="tile-stats" style="height:135px">
                    @*<div class="icon"><i class="fa fa-caret-square-o-right"></i></div>*@
                    <h4 style="margin-top:20px"><center>Persentase <br> Belanja (%)</center></h4>
                    <div style="margin:12px"><h2 style="font-size:15px; color:#02A35D" "><b><center>@persentase_belanja.ToString("N0", new System.Globalization.CultureInfo("id-ID")) </center></b></h2></div>
                    <p></p>
                </div>
            </div>

            @* pagu vs mp *@
            <div class="col-md-3 col-sm-2 col-xs-12">
                <div class="x_panel" id="paguvsmp" style="height:250px">
                </div>
            </div>

            <div class="col-md-3 col-sm-2 col-xs-12">
                <div class="x_panel" id="mpvsbelanja" style="height:250px">
                </div>
            </div>

            <div class="col-md-3 col-sm-2 col-xs-12">
                <div class="x_panel" id="belanjaops" style="height:250px">
                </div>
            </div>

            <div class="col-md-3 col-sm-2 col-xs-12">
                <div class="x_panel" id="belanjanonops" style="height:250px">
                </div>
            </div>

            <div class="col-md-6">
                <div class="x_panel" id="alokasibelanjaops" style="height:250px">
                </div>
            </div>

            @* Line Chart ALokasi VS Belanja NON OPS *@
            <div class="col-md-6">
                <div class="x_panel" id="alokasibelanjanonops" style="height:250px">
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        getPaguvsMp();
        mpvsbelanja();
        mpvsbelanjaops();
        mpbelanjanonops();
    });

    function getPaguvsMp(){
        var datamp = (@Html.Raw(Json.Encode(ViewBag.datamp)));
        var datapagu = (@Html.Raw(Json.Encode(ViewBag.datapagu)));
        var persenMp = Math.round(((@Html.Raw(Json.Encode(ViewBag.datamp)) || 0) /(@Html.Raw(Json.Encode(ViewBag.datapagu))))*100);

        //alert(isNAN(persenMp));
        Highcharts.chart('paguvsmp', {
            chart: {
                renderTo: 'container',
                plotBackgroundColor: null,
                plotBackgroundImage: null,
                plotBorderWidth: 0,
                plotShadow: false,
            },
            title: {
                text: 'PAGU VS MP',
                align: 'center',
                verticalAlign: 'top',
                y: 40
            },
            tooltip: {
                pointFormat: '{series.data[0]}: <b>{point.y}</b>'
            },
            pane: {
                center: ['50%', '70%'],
                size: '50%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    borderWidth: 0,
                    backgroundColor: 'none',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc'
                }
            },
            yAxis: [{
                lineWidth: 0,
                min: 0,
                max: 90,
                minorTickLength: 0,
                tickLength: 0,
                tickWidth: 0,
                labels: {
                    enabled: false
                },
                title: {
                    text: '', //'<div class="gaugeFooter">46% Rate</div>',
                    useHTML: true,
                    y: 80
                },
                /*plotBands: [{
                    from: 0,
                    to: 46,
                    color: 'pink',
                    innerRadius: '100%',
                    outerRadius: '0%'
                },{
                    from: 46,
                    to: 90,
                    color: 'tan',
                    innerRadius: '100%',
                    outerRadius: '0%'
                }],*/
                pane: 0,

            }],
            plotOptions: {
                pie: {
                    dataLabels: {
                        enabled: true,
                        distance: -50,
                        style: {
                            fontWeight: 'bold',
                            color: 'white',
                            textShadow: '0px 1px 2px black'
                        }
                    },
                    startAngle: -90,
                    endAngle: 90,
                    center: ['50%', '75%']
                },
                gauge: {
                    dataLabels: {
                        enabled: false
                    },
                    dial: {
                        radius: '100%'
                    }
                }
            },

            series: [{
                type: 'pie',
                name: 'Data',
                innerSize: '55%',
                data: [
                        ['MP', persenMp],
                        ['PAGU', 100]
                    @*['PAGU', Math.round(persenbelanja)],
                    ['MP', @nilai_mp[0]],*@

                    ]
            }, {
                type: 'gauge',
                //data: [ Math.round(persenbelanja)],
                data: [persenMp],
                dial: {
                    rearLength: 0
                }
            }],
        });
    }

    function mpvsbelanja(){
        //Chart Spedometer MP VS Belanja
        var persenMp = ((@Html.Raw(Json.Encode(ViewBag.datamp)) || 0) / (@Html.Raw(Json.Encode(ViewBag.datarealisasi)) || 0))*100;
        var datamp = (@Html.Raw(Json.Encode(ViewBag.datamp)));
        var datarealisasi = (@Html.Raw(Json.Encode(ViewBag.datarealisasi)));
        //alert(realisasi_dipa)
        Highcharts.chart('mpvsbelanja', {
            chart: {
                renderTo: 'container',
                plotBackgroundColor: null,
                plotBackgroundImage: null,
                plotBorderWidth: 0,
                plotShadow: false,
            },
            title: {
                text: 'MP VS Belanja',
                align: 'center',
                verticalAlign: 'top',
                y: 40
            },
            tooltip: {
                pointFormat: '{series.data[0]}: <b>{point.y}</b>'
            },
            pane: {
                center: ['50%', '77%'],
                size: '50%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    borderWidth: 0,
                    backgroundColor: 'none',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc'
                }
            },
            yAxis: [{
                lineWidth: 0,
                min: 0,
                max: 90,
                minorTickLength: 0,
                tickLength: 0,
                tickWidth: 0,
                labels: {
                    enabled: false
                },
                title: {
                    text: '', //'<div class="gaugeFooter">46% Rate</div>',
                    useHTML: true,
                    y: 80
                },
                /*plotBands: [{
                    from: 0,
                    to: 46,
                    color: 'pink',
                    innerRadius: '100%',
                    outerRadius: '0%'
                },{
                    from: 46,
                    to: 90,
                    color: 'tan',
                    innerRadius: '100%',
                    outerRadius: '0%'
                }],*/
                pane: 0,

            }],
            plotOptions: {
                pie: {
                    dataLabels: {
                        enabled: true,
                        distance: -10,
                        style: {
                            fontWeight: 'bold',
                            color: 'white',
                            textShadow: '0px 1px 2px black'
                        }
                    },
                    startAngle: -90,
                    endAngle: 90,
                    center: ['50%', '75%']
                },
                gauge: {
                    dataLabels: {
                        enabled: false
                    },
                    dial: {
                        radius: '100%'
                    }
                }
            },

            series: [{
                type: 'pie',
                name: 'Browser share',
                innerSize: '55%',
                data: [
                    ['Belanja', 22],
                    ['MP', 100],

                ]
            }, {
                type: 'gauge',
                data: [22],
                dial: {
                    rearLength: 0
                }
            }],
        });
    }

    function mpvsbelanjaops()
    {
        //alert(persenbelanja)
        var get_mpops = @Html.Raw(Json.Encode(ViewBag.getmpops));
        var get_belanjaops = @Html.Raw(Json.Encode(ViewBag.getbelanjaops));
        var persentaseops = Math.round((get_belanjaops/get_mpops)*100);
        //alert(persentaseops)
        Highcharts.chart('belanjaops', {
            chart: {
                renderTo: 'container',
                plotBackgroundColor: null,
                plotBackgroundImage: null,
                plotBorderWidth: 0,
                plotShadow: false
            },
            title: {
                text: 'MP VS Belanja OPS',
                align: 'center',
                verticalAlign: 'top',
                y: 40
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.y}%</b>'
            },
            pane: {
                center: ['50%', '70%'],
                size: '50%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    borderWidth: 0,
                    backgroundColor: 'none',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc'
                }
            },
            yAxis: [{
                lineWidth: 0,
                min: 0,
                max: 90,
                minorTickLength: 0,
                tickLength: 0,
                tickWidth: 0,
                labels: {
                    enabled: false
                },
                title: {
                    text: '', //'<div class="gaugeFooter">46% Rate</div>',
                    useHTML: true,
                    y: 80
                },
                /*plotBands: [{
                    from: 0,
                    to: 46,
                    color: 'pink',
                    innerRadius: '100%',
                    outerRadius: '0%'
                },{
                    from: 46,
                    to: 90,
                    color: 'tan',
                    innerRadius: '100%',
                    outerRadius: '0%'
                }],*/
                pane: 0,

            }],
            plotOptions: {
                pie: {
                    dataLabels: {
                        enabled: true,
                        distance: -10,
                        style: {
                            fontWeight: 'bold',
                            color: 'white',
                            textShadow: '0px 1px 2px black'
                        }
                    },
                    startAngle: -90,
                    endAngle: 90,
                    center: ['50%', '75%']
                },
                gauge: {
                    dataLabels: {
                        enabled: false
                    },
                    dial: {
                        radius: '100%'
                    }
                }
            },

            series: [{
                type: 'pie',
                name: '',
                innerSize: '55%',
                data: [
                    ['Belanja<br>OPS', persentaseops],
                    ['MP', 100],

                ]
            }, {
                type: 'gauge',
                data: [persentaseops],
                dial: {
                    rearLength: 0
                }
            }],
        });
    }

    function mpbelanjanonops ()
    {
        //alert(persenbelanja);
        var getmpnonops = @Html.Raw(Json.Encode(ViewBag.getmpnonops));
        var getbelanjanonops = @Html.Raw(Json.Encode(ViewBag.getbelanjanonops));
        var persentaseops = Math.round((getbelanjanonops/getmpnonops)*100);
        Highcharts.chart('belanjanonops', {
            chart: {
                renderTo: 'container',
                plotBackgroundColor: null,
                plotBackgroundImage: null,
                plotBorderWidth: 0,
                plotShadow: false
            },
            title: {
                text: 'MP VS Belanja Non OPS',
                align: 'center',
                verticalAlign: 'top',
                y: 40
            },
            tooltip: {
                pointFormat: '{series.data[0]}: <b>{point.y}%</b>'
            },
            pane: {
                center: ['50%', '78%'],
                size: '50%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    borderWidth: 0,
                    backgroundColor: 'none',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc'
                }
            },
            yAxis: [{
                lineWidth: 0,
                min: 0,
                max: 90,
                minorTickLength: 0,
                tickLength: 0,
                tickWidth: 0,
                labels: {
                    enabled: false
                },
                title: {
                    text: '', //'<div class="gaugeFooter">46% Rate</div>',
                    useHTML: true,
                    y: 80
                },
                /*plotBands: [{
                    from: 0,
                    to: 46,
                    color: 'pink',
                    innerRadius: '100%',
                    outerRadius: '0%'
                },{
                    from: 46,
                    to: 90,
                    color: 'tan',
                    innerRadius: '100%',
                    outerRadius: '0%'
                }],*/
                pane: 0,

            }],
            plotOptions: {
                pie: {
                    dataLabels: {
                        enabled: true,
                        distance: -10,
                        style: {
                            fontWeight: 'bold',
                            color: 'white',
                            textShadow: '0px 1px 2px black'
                        }
                    },
                    startAngle: -90,
                    endAngle: 90,
                    center: ['50%', '75%']
                },
                gauge: {
                    dataLabels: {
                        enabled: false
                    },
                    dial: {
                        radius: '100%'
                    }
                }
            },

            series: [{
                type: 'pie',
                name: 'Browser share',
                innerSize: '55%',
                data: [
                    //['MP', get_mpbelanjaops.persentase],
                    ['Belanja<br>Non OPS', persentaseops],
                    ['MP', 100],

                ]
            }, {
                type: 'gauge',
                data: [persentaseops],
                dial: {
                    rearLength: 0
                }
            }],
        });
    }

    function pembulatan(data) {
        //return this.value / 1000000000 + 'M';
        if (this.value >= 1E6) {
            return '' + data / 1000000000 + 'M';
        } else if(this.value == 0){
            return '0';
        }
        return '' + data / 1000000 + 'JT';
    }


     //Chart Line Alokasi VS Belanja OPS
    var resultArray = @Html.Raw(Json.Encode(ViewBag.RESULT));

    var AlokasiOps = @Html.Raw(Json.Encode(ViewBag.RESULTALOKOPS));
    console.log(AlokasiOps);
    var BulanAlokasiOps = @Html.Raw(Json.Encode(ViewBag.BULANALOKOPS));

    var belanjaNonOps = @Html.Raw(Json.Encode(ViewBag.belanjaNonOps));
    var belanjaOps = @Html.Raw(Json.Encode(ViewBag.belanjaOps));
    var bulan = @Html.Raw(Json.Encode(ViewBag.bulan));
    var bulanNonOps = @Html.Raw(Json.Encode(ViewBag.bulanNonOps));
    var bulanOps = @Html.Raw(Json.Encode(ViewBag.bulanOps));

    $(document).ready(function () {
        //console.log(resultArray[0]);
        //console.log(bulan);
        //if(resultArray){
        var alokasi = [];
        var alokasiops = [];
        var nonOps = [];
        var ops = [];
        for (i=1;i<=12;i++){
            var cek = true;
            var cekNonOps = true;
            var cekOps = true;
            var cekAlokasiOps = true;
            //Show Alokasi (Line Chart)
            $.each(bulan, function(j,v){
                if(i == v){
                    alokasi.push(resultArray[j]);
                    cek = false;
                }
            });

            if(cek){
                alokasi.push(0);
                //console.log(bulan);
            }

            //Show Alokasi OPS
            $.each(BulanAlokasiOps, function(j,v){
                if(i == v){
                    alokasiops.push(AlokasiOps[j]);
                    cek = false;
                }
            });

            if(cekAlokasiOps){
                alokasiops.push(0);
                //console.log(bulan);
            }
            //Show Alokasi OPS

            //Show Belanja NonOps (Line Chart)
            $.each(bulanNonOps, function(j,v){
                if(i == v){
                    nonOps.push(belanjaNonOps[j]);
                    cekNonOps = false;
                }
            });

            if(cekNonOps){
                nonOps.push(0);
                //console.log(bulan);
            }

            //Show Belanja Ops (Line Chart)
            $.each(bulanOps, function(j,v){
                if(i == v){
                    ops.push(belanjaOps[j]);
                    cekOps = false;
                }
            });

            if(cekOps){
                ops.push(0);
                //console.log(bulan);
            }

        }

        Highcharts.chart('alokasibelanjaops', {
            chart: {
                renderTo: 'container',
                type: 'line'
            },

            title: {
                text: 'Alokasi VS Belanja OPS'
            },

            subtitle: {
                text: ''
            },

            xAxis: {
                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            },

            yAxis: {
                title: {
                    text: 'Miliar'
                },
                labels: {
                    formatter: function() {
                        //return this.value / 1000000000 + 'M';
                        if (this.value >= 1E6) {
                            return '' + this.value / 1000000000 + 'M';
                        } else if(this.value == 0){
                            return '0';
                        }
                        return '' + this.value / 1000000 + 'JT';
                    }
                }
            },

            plotOptions: {
                line: {
                    dataLabels: {
                        enabled: false,
                        //formatter: function() {
                        //    //return this.value / 1000000000 + 'M';
                        //    if (this.y >= 1E6) {
                        //        return this.y / 1000000000;
                        //    } else if(this.y == 0){
                        //        return '0';
                        //    }
                        //    return '' + this.y / 1000000 + 'JT';
                        //}
                    },
                    enableMouseTracking: true
                }
            },
            series: [{
                name: 'Alokasi',
                data: alokasiops
            }, {
                name: 'Belanja OPS',
                //data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                data: ops
            }]
        });

        //Chart Line Alokasi VS Belanja NON-OPS
        Highcharts.chart('alokasibelanjanonops', {
            chart: {
                type: 'line'
            },
            title: {
                text: 'Alokasi VS Belanja Non-OPS'
            },
            subtitle: {
                text: ''
            },
            xAxis: {
                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
            },
            yAxis: {
                title: {
                    text: 'Miliar'
                },
                labels: {
                    formatter: function() {
                        //return this.value / 1000000000 + 'M';
                        if (this.value >= 1E6) {
                            return '' + this.value / 1000000000 + 'M';
                        } else if(this.value == 0){
                            return '0';
                        }
                        return '' + this.value / 1000000 + 'JT';
                    }
                }
            },
            plotOptions: {
                line: {
                    dataLabels: {
                        enabled: false
                    },
                    enableMouseTracking: true
                }
            },
            series: [{
                name: 'Alokasi',
                color: "#F7B123",

                data: alokasi
            }, {
                name: 'Belanja Non-OPS',
                color: "#37659D",
                //data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                data: nonOps
            }]
        });
       
    });
</script>