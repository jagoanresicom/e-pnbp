(function(n){function i(t,i,r){n(t).autocomplete({source:function(t,i){n.ajax({url:GSearchUrl,type:"POST",data:{loc:encodeURIComponent(t.term)},success:function(n){for(var r=[],t=0;t<n.length;t++)r.push({label:n[t].name,value:n[t].name,geom:n[t].geometry,fmtaddr:n[t].formatted_address});i(r)}})},minLength:5,delay:500,select:function(t,u){var f=u.item.geom.viewport.southwest,e=u.item.geom.viewport.northeast,o=r.getView().getProjection().getCode(),s=ol.extent.boundingExtent([ol.proj.transform([f.lng,f.lat],"EPSG:4326",o),ol.proj.transform([e.lng,e.lat],"EPSG:4326",o)]);r.getView().fit(s,{duration:1200,nearest:!0});n(i).hasClass("aktif")||n(i).toggleClass("aktif")}}).data("ui-autocomplete")._renderItem=function(t,i){return n("<li>").append(n("<div>").addClass("ui-menu-item-wrapper").append(n("<a>").addClass("title").append(i.label)).append(n("<p>").append(i.fmtaddr))).appendTo(t)};n(i).click(function(){n(t).val("");n(this).toggleClass("aktif")})}function r(i,r,u){function s(t){var i=t.element,u=i.get("baseLayer"),r=u?this.baseitem:this.overlayitem;u?this.optype==="remove"?n(r).find(':input[value="'+i.get("name")+'"]').closest("li").remove():(h(i,r),n('[name="basemap"]').change(function(){l(this.value)}),i.setZIndex(-1)):this.optype==="remove"?n(r).find('li[data-layer-type="layer"][data-layer-name="'+i.get("name")+'"]').remove():c(i,r,"layer")}function h(t,i){var u=n('<li role="menuitemradio" class="list-group-item"><\/li>'),r=n('<label class="baselabel"><\/label>'),f=n('<input type="radio" name="basemap" value="'+t.get("name")+'" />'),e=n('<span class="checkmark"><\/span>');n(i).append(u);u.append(r);r.append(t.get("title"));r.append(f);r.append(e)}function c(t,i,r){var e=t.getSource(),o,h,u;if(e instanceof ol.source.TileWMS&&e.getParams().LAYERS!==undefined){if(r==="layer"){o=n('<li class="list-group-item" data-layer-type="layer" data-layer-name="'+t.get("name")+'"><\/li>');var w=n('<label class="layer-header"><\/label>'),l=n('<label class="layer-control"><\/label>'),p=n('<button type="button" class="btn-xs btn-danger remove-layer" title="Hapus layer"><span class="glyphicon glyphicon-trash"><\/span><\/button>');w.append(t.get("title"));w.append('<input type="checkbox" data-toggle="collapse" data-target="#'+t.get("name")+'" />');w.append('<span class="toggle-indicator move"><\/span>');l.append('<input type="checkbox"'+(t.getVisible()?' checked="checked"':"")+' aria-label="'+t.get("title")+'" />');l.append('<div class="sld round" title="Sembunyikan layer"><\/div>');l.append(p);p.click({layer:t,type:"layer",name:t.get("name"),title:t.get("title")},v);o.append(w);o.append(l);l.find("input").change({layer:t,type:"layer",name:t.get("name")},a);h=n('<ul id="'+t.get("name")+'" class="overlay-sublayers list-group collapse" style="padding-top:5px"><\/ul>');o.append(h);n(i).find(".overlay-layers").append(o)}else o=n(i).find('li[data-layer-name="'+t.get("name")+'"]'),h=o.find("#".concat(t.get("name"))),h.empty();var s=e.get("layers"),d=e.getParams().LAYERS.split(","),g=e.urls,it=LayerProxy.concat(g[Math.floor(Math.random()*g.length)],"request=GetLegendGraphic&format=image/png&transparent=true&layer={0}"),nt=[],tt=[];for(u=0;u<s.length;u++){var f=s[u].name,b=n('<li class="list-group-item" data-layer-type="sublayer" data-layer-name="'+f+'"><\/li>'),k=n('<label class="layer-header"><\/label>'),c=n('<label class="layer-control"><\/label>'),rt=n('<div class="legend-ctr collapse" id="'+f.replace(":","__")+'"><img class="move" alt="..." src="'+it.replace("{0}",f)+'" /><\/div>');p=n('<button type="button" class="btn-xs btn-danger remove-layer" title="Hapus layer"><span class="glyphicon glyphicon-trash"><\/span><\/button>');k.append(s[u].title);k.append('<input type="checkbox" data-toggle="collapse" data-target="#'+f.replace(":","__")+'" />');k.append('<span class="toggle-indicator move"><\/span>');c.append();c.append('<input type="checkbox"'+(d.includes(f)?' checked="checked"':"")+' aria-label="'+s[u].title+'" />');c.append('<div class="sld round" title="Sembunyikan layer"><\/div>');c.append(p);c.find("input").change({layer:t,type:"sublayer",name:f},a);b.append(k);b.append(c);b.append(rt);h.append(b);p.click({layer:t,type:"sublayer",name:f,title:s[u].title},v);d.includes(f)&&(nt.push(f),tt.push(s[u].filter?s[u].filter:"INCLUDE"))}e.updateParams({LAYERS:nt.reverse().join()});e.updateParams({CQL_FILTER:tt.reverse().join(";")});h.sortable({update:function(n,t){y(this,t)},handle:".move"})}}function l(n){u.getLayers().forEach(function(t){t.get("baseLayer")&&t.setVisible(t.get("name")===n)})}function a(t){var r=t.data.layer,u=r.getSource(),c=u.get("layers"),i,s;if(t.data.type==="layer")u.getParams().LAYERS.trim()&&r.setVisible(this.checked);else{var e=[],h=[],o,f=n(this).closest("ul").find("li");for(i=0;i<f.length;i++)n(f[i]).find(".layer-control input")[0].checked&&(e.push(n(f[i]).data("layer-name")),o=c.find(function(t){return t.name===n(f[i]).data("layer-name")}),h.push(o.filter?o.filter:"INCLUDE"));u.updateParams({LAYERS:e.reverse().join()});u.updateParams({CQL_FILTER:h.reverse().join(";")});s=n(this).closest("ul").parent("li").find(".layer-control input[aria-label='"+r.get("title")+"']")[0];e.length===0?r.setVisible(!1):s&&s.checked&&r.setVisible(!0)}n(this).parent("label").find("div").attr("title",this.checked?"Sembunyikan layer":"Tampilkan layer")}function p(){var t,r,i,e;f.type==="layer"?u.removeLayer(f.layer):(t=f.layer.getSource().getParams().LAYERS.split(","),r=[],t.splice(t.indexOf(f.name),1),f.layer.getSource().get("layers")&&(i=f.layer.getSource().get("layers"),e=i.find(function(n){return n.name===f.name}),i.splice(i.indexOf(e),1)),t.forEach(function(n){var t=f.layer.getSource().get("layers").find(function(t){return t.name===n});r.push(t.filter?t.filter:"INCLUDE")}),f.layer.getSource().updateParams({LAYERS:t.reverse().join()}),f.layer.getSource().updateParams({CQL_FILTER:r.reverse().join(";")}),n(o).closest("li").remove());n.unblockUI()}function v(i){n("#cfmdlg>p").html("Yakin menghapus layer <b>".concat(i.data.title,"<\/b>?"));n.blockUI({message:n("#cfmdlg")});t="rmlayer";f=i.data;o=this}function y(t,i){var h=i.item.data("layer-type"),s=u.getLayers().getArray(),r,f,e,o;h==="layer"?(r=n(t).children("li"),r.each(function(t,i){f=s.find(function(t){return t.get("name")===n(i).data("layer-name")});f.setZIndex(r.length-1-t)})):(r=[],f=s.find(function(n){return n.get("name")===t.id}),e=[],n(t).children("li").each(function(t,i){n(i).find(".layer-control input").prop("checked")&&(r.push(n(i).data("layer-name")),o=f.getSource().get("layers").find(function(t){return t.name===n(i).data("layer-name")}),e.push(o.filter?o.filter:"INCLUDE"))}),f.getSource().updateParams({LAYERS:r.reverse().join()}),f.getSource().updateParams({CQL_FILTER:e.reverse().join(";")}))}var f,o,e=u.getLayers();e.forEach(function(t){var u=t.get("baseLayer");u?h(t,n(r)):c(t,n(i),"layer")});n(".overlay-layers").sortable({update:function(n,t){y(this,t)},handle:".move"});n('[name="basemap"]').change(function(){l(this.value)});n('[name="basemap"]:first').prop("checked",!0).trigger("change");(navigator.userAgent.match(/edge/i)||navigator.userAgent.match(/trident/i))&&n(".ol-control").css("font-size","12px");n("#cfmdlg>input").click(function(i){if(i.preventDefault(),n(this).val()==="Batal")return n.unblockUI(),!1;t==="rmlayer"&&p()});e.on("remove",s.bind({optype:"remove",baseitem:n(r),overlayitem:n(i)}));e.on("add",s.bind({optype:"add",baseitem:n(r),overlayitem:n(i)}));e.on("change",function(n){console.log(n)})}function u(t,i,r){function s(t){var r=this.evt,e=this.viewResolution,i;return t.get("name")==="atrbpn"&&(i=t.getSource().getGetFeatureInfoUrl(r.coordinate,e,olm.getView().getProjection().getCode(),{INFO_FORMAT:"application/json"}),i)?(n.blockUI({message:'<div style="padding:10px"><b>Sedang proses... <\/b><p>harap tunggu<\/p><\/div>'}),n.ajax({url:InfoAction,method:"POST",data:{infourl:i.concat("&FEATURE_COUNT=10")},success:function(t){var e=(new ol.format.GeoJSON).readProjection(t),i,r;i=olm.getView().getProjection().getCode().match(/\d+/)[0]===e.getCode().match(/\d+/)[0]?(new ol.format.GeoJSON).readFeatures(t):new ol.format.GeoJSON({featureProjection:olm.getView().getProjection()}).readFeatures(t);infoFeatures=infoFeatures.concat(i);infpgsz+=infoFeatures.length;i&&i.length>0&&(u.refresh(),r=infoFeatures[0],f({featureId:r.getId(),page:1}));n.unblockUI()},error:function(){n.unblockUI()}}),!0):!1}function h(n){return n.get("name")==="atrbpn"}function f(t){n.blockUI({message:'<div style="padding:10px"><b>Sedang proses... <\/b><p>harap tunggu<\/p><\/div>'});u.clear();n(e).load(DetilInfoAction,t);var i=infoFeatures.find(function(n){if(n.getId()===t.featureId)return n});u.addFeature(i);n.unblockUI()}var e=document.getElementById("infocontent"),o=document.getElementById("infocloser"),u=r.getSource();o.onclick=function(){return i.setPosition(undefined),this.blur(),!1};t.on("singleclick",function(n){u.clear();i.setPosition(undefined);infoFeatures=[];infpgsz=0;var t=this.getView().getResolution(),r=this.getEventPixel(n.originalEvent),f=this.forEachLayerAtPixel(r,s.bind({evt:n,viewResolution:t}),this,h);f&&i.setPosition(n.coordinate)});navDetilInfo=function(n,t){var i=n==="prev"?t-1:t+1;infoFeatures[i-1]&&f({featureId:infoFeatures[i-1].getId(),page:i})}}function f(){function l(n,t){this.lyrname==="atrbpn"?n.getImage().src=LayerProxy.concat(t):this.lyrname==="petadasar"&&(n.getImage().src=t)}var f,i,t,e,o,s;n("#peta").height(n(window).outerHeight()-n(".nav_menu").outerHeight()-3);n("#wrapper").accordion("refresh");var h=new ol.style.Circle({radius:5,fill:null,stroke:new ol.style.Stroke({color:"blue",width:2})}),a={Point:new ol.style.Style({image:h}),LineString:new ol.style.Style({stroke:new ol.style.Stroke({color:"green",width:1})}),MultiLineString:new ol.style.Style({stroke:new ol.style.Stroke({color:"green",width:1})}),MultiPoint:new ol.style.Style({image:h}),MultiPolygon:new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",width:1}),fill:new ol.style.Fill({color:"rgba(255, 255, 0, 0.2)"})}),Polygon:new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",lineDash:[4],width:3}),fill:new ol.style.Fill({color:"rgba(0, 0, 255, 0.2)"})}),GeometryCollection:new ol.style.Style({stroke:new ol.style.Stroke({color:"magenta",width:2}),fill:new ol.style.Fill({color:"magenta"}),image:new ol.style.Circle({radius:10,fill:null,stroke:new ol.style.Stroke({color:"magenta"})})}),Circle:new ol.style.Style({stroke:new ol.style.Stroke({color:"red",width:2}),fill:new ol.style.Fill({color:"rgba(255,0,0,0.2)"})})},v=function(n){return a[n.getGeometry().getType()]},y=document.getElementById("infopanel"),r=new ol.Overlay({element:y,autoPan:!0,autoPanAnimation:{duration:250}}),p=new ol.source.Vector({format:new ol.format.GeoJSON({featureProjection:ol.proj.get("EPSG:3857")})}),c=new ol.layer.Vector({source:p,style:v,name:"info"});infoPopup=r;f=new ol.layer.Tile({source:new ol.source.TileWMS({urls:WMSUrl.split(","),params:{LAYERS:"".concat(WMSStoreNS+":PersilBerdasarkanJenisHak,"+WMSStoreNS+":PERSILSIPT"),TILED:!0,CQL_FILTER:"INCLUDE;INCLUDE"},serverType:"geoserver",tileLoadFunction:l.bind({lyrname:"atrbpn"})}),name:"atrbpn",title:"ATR/BPN Layer"});f.getSource().set("layers",[{name:"".concat(WMSStoreNS,":PERSILSIPT"),title:"Bidang Pengadaan Tanah"},{name:"".concat(WMSStoreNS,":PersilBerdasarkanJenisHak"),title:"Persil Berdasarkan Jenis Hak"},{name:"".concat(WMSStoreNS,":ZONANILAITANAHNOLABEL"),title:"Zona Nilai Tanah",filter:"VALIDSAMPAI IS NULL"},{name:"".concat("tante:OBJEKTANTE"),title:"Tanah Terlantar",filter:"VALIDSAMPAI IS NULL"}]);window.app={};i=window.app;i.ContainerControl=function(n){var i=n||{},t=document.createElement("div");t.className="ol-ctrlcontainer ol-unselectable ol-control";ol.control.Control.call(this,{element:t,target:i.target})};ol.inherits(i.ContainerControl,ol.control.Control);t=new i.ContainerControl;olm=new ol.Map({controls:[t],layers:[new ol.layer.Tile({source:new ol.source.OSM,name:"osm",title:"Open Street Map",zIndex:0,baseLayer:!0}),new ol.layer.Tile({visible:!1,preload:Infinity,baseLayer:!0,name:"bing",title:"Bing Map Aerial",zIndex:0,source:new ol.source.BingMaps({key:BMK,imagerySet:"AerialWithLabels"})}),new ol.layer.Tile({source:new ol.source.XYZ({attributions:[new ol.Attribution({html:"<a href='//www.atrbpn.go.id/' target='_blank'><span class='glyphicon glyphicon-copyright-mark'><\/span>ATR/BPN RI<\/a>"})],url:pdurl,tileLoadFunction:l.bind({lyrname:"petadasar"})}),name:"petadasar",title:"Peta Dasar Pertanahan",zIndex:0,visible:!1,baseLayer:!0}),f,c],overlays:[r],target:"peta",view:new ol.View({center:[13100695.15185293,-264166.36975356936],zoom:4})});olm.addControl(new ol.control.ScaleLine);olm.addControl(new ol.control.Attribution);e=new ol.control.Zoom({target:t.element});olm.addControl(e);o=new ol.control.ZoomToExtent({extent:[10719664,-1663463,15450199,1252149],tipLabel:"Zoom Indonesia",target:t.element});olm.addControl(o);s=new ol.control.Rotate({target:t.element});olm.addControl(s);n([e.element,o.element,s.element]).removeClass("ol-control ol-unselectable");n(".ol-zoom-extent button").html('<span class="fa fa-expand"><\/span>');u(olm,r,c)}var t="";Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,value:function(n){var t=this.filter(function(t){return t===n});return t.length>0}});Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(n){var i,u,f,t,r;if(this===null)throw new TypeError('"this" is null or not defined');if(i=Object(this),u=i.length>>>0,typeof n!="function")throw new TypeError("predicate must be a function");for(f=arguments[1],t=0;t<u;){if(r=i[t],n.call(f,r,t,i))return r;t++}return undefined}});String.prototype.startsWith||(String.prototype.startsWith=function(n){return this.indexOf(n)===0?!0:!1});String.prototype.endsWith||(String.prototype.endsWith=function(n){return this.indexOf(n,this.length-n.length)!==-1});n(document).ready(function(){f();r("#overlayitem","#basemapitem",olm);i("#gSearch","#clrSearch",olm)});clearSelect=function(){var t=olm.getLayers(),n;t.forEach(function(t){if(t.get("name")==="info"){n=t;return}});n.getSource().clear()};showBidangSipt=function(n){var f=olm.getLayers(),r,t,i,u;f.forEach(function(n){if(n.get("name")==="info"){r=n;return}});r&&(t=r.getSource(),infoPopup.setPosition(undefined),t.clear(),i=t.getFormat().readFeatures(n),i&&i.length>0?(u=i[0],t.addFeature(u),olm.getView().fit(u.getGeometry(),{duration:1200,nearest:!1})):alert("Tidak ada di peta."))};n(window).resize(function(){n("#peta").height(n(window).outerHeight()-n(".nav_menu").outerHeight()-3);n(".peta-side-menu").hasClass("active")&&n("#wrapper").accordion("refresh")});n(".menu-toggle").on("click",function(){n("#pmask").toggleClass("active");n(".peta-side-menu").toggleClass("active");n(".peta-side-menu").hasClass("active")?(setTimeout(function(){n("#wrapper").accordion("refresh")},100),n("#wrapper").accordion({active:activeaccrd})):activeaccrd=n("#wrapper").accordion("option","active")});n("#pmask").on("click",function(){n(".menu-toggle").click();n(".peta-side-menu").toggleClass("active");n(this).toggleClass("active")});n(".search-toggle").click(function(t){t.preventDefault();var i=n(".scwrapper");i.toggleClass("collapsed expanded");i.hasClass("collapsed")&&(n("#gSearch").val(""),n("#clrSearch").hasClass("aktif")&&n("#clrSearch").toggleClass("aktif"))})})(jQuery);