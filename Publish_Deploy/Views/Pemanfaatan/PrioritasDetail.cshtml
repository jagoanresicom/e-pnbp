@model Pnbp.Entities.DataPrioritas

@{
    ViewBag.Judul = "Daftar Prioritas Non Operasional";
}

<style>
    td.numeric, th.numeric {
        text-align: right;
    }

    .editors {
        display: none;
    }

    /*tr:hover,*/ 
    /*tr.selected, tr.selected {
        background-color: #B0BED9 !important;
    }*/
</style>

<div class="">
    <div class="clearfix"></div>
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_title">
            <h2>@(ViewBag.Judul) - @Model.NamaSatKer</h2>
            <div class="title_right">
                <div class="pull-right">
                    <button id="Tambah-btn" type="button" class="btn btn-success">Tambah</button>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="x_panel">
                <div class="table-responsive" style="border:none">
                    <section id="flip-scroll">
                        <table class="table table-striped hover dt-responsive nowrap" style="clear: both; border-collapse: collapse; width: 100%;">
                            <thead>
                                <tr>
                                    <th class="centertaligncolumn">Aktif?</th>
                                    @*<th class="centertaligncolumn">Prioritas</th>*@
                                    <th>Satuan Kerja / Kode / Program </th>
                                    @*<th>Satuan Kerja</th>
                                <th>Kode</th>
                                <th>Program</th>*@
                                    @* <th>Status</th>*@
                                    <th class="numeric">Anggaran (Rp)</th>
                                    <th class="numeric">Alokasi (Rp)</th>
                                    <th class="numeric">Persentase (%)</th>
                                    <th class="numeric">Rencana <br />Alokasi (Rp)</th>
                                    <th style="text-align:center; width:5%;">Entri</th>
                                </tr>
                            </thead>

                            <tbody id="listmanfaatholder">
                                @foreach (var item in Model.dataPrioritas)
                                {
                                    <tr id="@item.Manfaatid">
                                        <td class="centertaligncolumn">
                                            @if (@item.Statusaktif == "Aktif")
                                            {
                                                if (@Model.UserAdmin)
                                                {
                                                    <input type="checkbox" checked="checked" disabled="disabled" name="table1_records">
                                                }
                                                else
                                                {
                                                    <input type="checkbox" checked="checked" disabled="disabled" name="table1_records">
                                                }
                                            }
                                            else
                                            {
                                                if (@Model.UserAdmin)
                                                {
                                                    <input type="checkbox" name="table_records">
                                                }
                                                else
                                                {
                                                    <input type="checkbox" disabled="disabled" name="table_records">
                                                }
                                            }
                                        </td>
                                        @*<td class="numeric">@(item.Prioritaskegiatan)</td>*@
                                        <td>@item.Namaprogram</td>
                                        @*<td>@item.Namasatker <br/>@item.Kodesatker <br/>@item.Namaprogram</td>*@
                                        @*<td>@item.Namasatker</td>
                                    <td>@item.Kodesatker</td>
                                    <td>@item.Namaprogram</td>*@
                                        @* <td>@item.Statusaktif</td>*@
                                        <td class="numeric">@item.Nilaianggaran.ToString("N0", new System.Globalization.CultureInfo("id-ID"))</td>
                                        <td class="numeric">@item.Teralokasi.ToString("N0", new System.Globalization.CultureInfo("id-ID"))</td>
                                        <td class="numeric">@Math.Round((item.Teralokasi / item.Nilaianggaran * 100), 2)</td>
                                        <td class="numeric">@item.Alokasi.ToString("N0", new System.Globalization.CultureInfo("id-ID"))</td>
                                        <td style="text-align:center;cursor: pointer;" onclick="showprioritas('@item.Manfaatid');"><i class="fa fa-pencil"></i></td>
                                    </tr>
                                }

                                <tr>
                                    <td colspan="2" class="numeric">Total</td>
                                    <td class="myLabelContentRight">@Model.dataPrioritas.Sum(a => a.Nilaianggaran).ToString("N0", new System.Globalization.CultureInfo("id-ID"))</td>
                                    <td class="myLabelContentRight">@Model.dataPrioritas.Sum(a => a.Teralokasi).ToString("N0", new System.Globalization.CultureInfo("id-ID"))</td>
                                    <td class="myLabelContentRight">@Math.Round((Model.dataPrioritas.Sum(a => a.Teralokasi) / Model.dataPrioritas.Sum(a => a.Nilaianggaran) * 100), 2)</td>
                                    <td class="myLabelContentRight">@Model.dataPrioritas.Sum(a => a.Alokasi).ToString("N0", new System.Globalization.CultureInfo("id-ID"))</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>

<div id='myModal' class='modal'>
    <div id='myModalContent'>
    </div>
</div>

<script type="text/javascript">
    (function (a) { a.createModal = function (b) { defaults = { title: "", message: "Your Message Goes Here!", closeButton: true, scrollable: false }; var b = a.extend({}, defaults, b); var c = (b.scrollable === true) ? 'style="max-height: 420px;overflow-y: auto;"' : ""; html = '<div class="modal fade" id="myModal">'; html += '<div class="modal-dialog">'; html += '<div class="modal-content">'; html += '<div class="modal-header">'; html += '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>'; if (b.title.length > 0) { html += '<h4 class="modal-title">' + b.title + "</h4>" } html += "</div>"; html += '<div class="modal-body" ' + c + ">"; html += b.message; html += "</div>"; html += '<div class="modal-footer">'; if (b.closeButton === true) { html += '<button type="button" class="btn btn-primary" data-dismiss="modal" id="btn-ok">OK</button>' } html += "</div>"; html += "</div>"; html += "</div>"; html += "</div>"; a("body").prepend(html); a("#myModal").modal().on("hidden.bs.modal", function () { a(this).remove() }) } })(jQuery);
    function showmsg(judul, isi) { $.createModal({ title: judul, message: isi, closeButton: true, scrollable: false }); return false; };

    $(document).ready(function () {
        $.unblockUI();
    });

    //$(document).on('dblclick', 'tr', function () {
    //    $(this).addClass("selected");
    //    var id = $(this).attr('id');
    //    showprioritas(id);
    //});

    //$('td').click(function (event) {
    //    if ($(event.target).is('input')) {
    //        $('input:checkbox', this).prop('checked', function (i, value) {
    //        });
    //    }
    //});

    $("#Tambah-btn").click(function (e) {
        if ('@Model.UserAdmin' == 'True') {
            $.blockUI({ message: '<div style=\"padding:10px\"><b>Sedang proses... </b><p>harap tunggu</p></div>' });
            var pdata = { s: '', m: 'New' };
            $.ajax({
                type: 'POST',
                url: '@Url.Action("ShowPrioritas", "Pemanfaatan")',
                data: pdata,
                success: function (data, textStatus, XMLHttpRequest) {
                    $('#myModal').show();
                    $('#myModalContent').html(data);
                    $.unblockUI();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) { console.log(textStatus); $.unblockUI(); }
            });
        }
        else {
            alert("Anda tidak mempunyai akses untuk menambah data!");
        }
    });


    //$("tr").click(function () {
    //    $(this).addClass("selected").siblings().removeClass("selected");
    //});

    function showprioritas(id) {
        if ('@Model.UserAdmin' == 'True') {
            $.blockUI({ message: '<div style=\"padding:10px\"><b>Sedang proses... </b><p>harap tunggu</p></div>' });
            var pdata = { s: id, m: 'Update' };
            $.ajax({
                type: 'POST',
                url: '@Url.Action("ShowPrioritas", "Pemanfaatan")',
                data: pdata,
                success: function (data, textStatus, XMLHttpRequest) {
                    $('#myModal').show();
                    $('#myModalContent').html(data);
                    $.unblockUI();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) { console.log(textStatus); $.unblockUI(); }
            });
        }
        else {
            alert("Anda tidak mempunyai akses untuk merubah data!");
        }
    };
</script>
